<!DOCTYPE html>
<!-- _layouts/distill.html --><html>
  <head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">    <!-- Metadata, OpenGraph and Schema.org -->
    

    <!-- Standard metadata -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Introduction to rustworkx | Soon  Teh</title>
    <meta name="author" content="Soon  Teh">
    <meta name="description" content="With examples on IBM quantum devices">


    <!-- Bootstrap & MDB -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha256-DF7Zhf293AJxJNTmh5zhoYYIMs2oXitRfBjY+9L//AY=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous">

    <!-- Bootstrap Table -->
    <link defer rel="stylesheet" href="https://unpkg.com/bootstrap-table@1.21.4/dist/bootstrap-table.min.css">

    <!-- Fonts & Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/academicons@1.9.1/css/academicons.min.css" integrity="sha256-i1+4qU2G2860dGGIOJscdC30s9beBXjFfzjWLjBRsBg=" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons">

    <!-- Code Syntax Highlighting -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/github.css" media="" id="highlight_theme_light">

    

    <!-- Styles -->
    
    <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%E2%9A%9B%EF%B8%8F&lt;/text&gt;&lt;/svg&gt;">
    
    <link rel="stylesheet" href="/assets/css/main.css">
    <link rel="canonical" href="https://soon-teh.github.io/blog/2023/intro-to-rustworkx/">

    <!-- Dark Mode -->
    


    <!-- jQuery -->
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>

    <!-- MathJax -->
  <script type="text/javascript">
    window.MathJax = {
      tex: {
        tags: 'ams'
      }
    };
  </script>
  <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script>
  <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>

    <!-- Distill js -->
    <script src="/assets/js/distillpub/template.v2.js"></script>
    <script src="/assets/js/distillpub/transforms.v2.js"></script>
    <script src="/assets/js/distillpub/overrides.js"></script>
    
    <!-- Page/Post style -->
    <style type="text/css">
      .post-img {
  max-height: 80vh;
  max-width: 100%;
}

    </style>
  </head>

  <body>
<d-front-matter>
    <script async type="text/json">{
      "title": "Introduction to rustworkx",
      "description": "With examples on IBM quantum devices",
      "published": "June 7, 2023",
      "authors": [
        {
          "author": "Soon Teh",
          "authorURL": "",
          "affiliations": [
            {
              "name": "EQuIP, OIST",
              "url": ""
            }
          ]
        }
        
      ],
      "katex": {
        "delimiters": [
          {
            "left": "$",
            "right": "$",
            "display": false
          },
          {
            "left": "$$",
            "right": "$$",
            "display": true
          }
        ]
      }
    }</script>
  </d-front-matter>

  

    <!-- Header -->
    <header>

      <!-- Nav Bar -->
      <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top">
        <div class="container">
          <a class="navbar-brand title font-weight-lighter" href="/"><span class="font-weight-bold">Soon </span>Teh</a>
          <!-- Navbar Toggle -->
          <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar top-bar"></span>
            <span class="icon-bar middle-bar"></span>
            <span class="icon-bar bottom-bar"></span>
          </button>

          <div class="collapse navbar-collapse text-right" id="navbarNav">
            <ul class="navbar-nav ml-auto flex-nowrap">

              <!-- About -->
              <li class="nav-item ">
                <a class="nav-link" href="/">about</a>
              </li>
              
              <!-- Blog -->
              <li class="nav-item active">
                <a class="nav-link" href="/blog/">blog<span class="sr-only">(current)</span></a>
              </li>

              <!-- Other pages -->
              <li class="nav-item ">
                <a class="nav-link" href="/publications/">publications</a>
              </li>
              <li class="nav-item ">
                <a class="nav-link" href="/teaching/">teaching</a>
              </li>
            </ul>
          </div>
        </div>
      </nav>

      <!-- Scrolling Progress Bar -->
      <progress id="progress" value="0">
        <div class="progress-container">
          <span class="progress-bar"></span>
        </div>
      </progress>
    </header>


    <!-- Content -->
    <div class="post distill">

      <d-title>
        <h1>Introduction to rustworkx</h1>
        <p>With examples on IBM quantum devices</p>
      </d-title>

      <d-byline></d-byline>

      <d-article>
        <d-contents>
          <nav class="l-text figcaption">
          <h3>Contents</h3>
            <div><a href="#rustworkx">rustworkx</a></div>
            <div><a href="#ibm-hardware-coupling-map">IBM Hardware Coupling Map</a></div>
            <div><a href="#map-coloring-efficient-measurement-and-chemical-structure">Map Coloring, Efficient Measurement and Chemical Structure</a></div>
            <div><a href="#final-remarks">Final Remarks</a></div>
            
          </nav>
        </d-contents>

        <h2 id="rustworkx">rustworkx</h2>
<p>Qiskit uses <a href="https://github.com/Qiskit/rustworkx" rel="external nofollow noopener" target="_blank"><strong>rustworkx</strong></a> (or formerly <strong>retworkx</strong>), a graph library under the hood. rustworkx was originally conceived to build a faster directed acyclic graph (DAG) to use as the underlying data structure for qiskit-terra’s transpiler. For instance, a Bell state circuit can be represented as a directed graph as follows:</p>

<p><img class="mx-auto d-block mb-2 post-img" src="/assets/img/2023-06-07/bell.png"><br></p>

<p>Prior to rustworkx, qiskit uses <a href="https://networkx.org/" rel="external nofollow noopener" target="_blank"><strong>NetworkX</strong></a>. NetworkX’s pure Python implementation leads to a performance bottleneck, and thus rustworkx addressed this by implemnting the graph data structures and algorithms in Rust. The performance gain was documented to be 3x to 100x for the same use case compared to NetworkX.<d-cite key="Treinish_2022"></d-cite></p>

<p>Despite basing on NetworkX, rustworkx is not a drop-in replacement, and some of its implementation varies. Key differences and conversion guide can be found <a href="https://qiskit.org/documentation/retworkx/networkx.html" rel="external nofollow noopener" target="_blank">here</a>. This blog post will be looking at some of rustworkx’s features and application of a graph algorithm in quantum computing.</p>

<h2 id="ibm-hardware-coupling-map">IBM Hardware Coupling Map</h2>
<p>This section will use IBM’s hardware coupling map as an example to demonstrate some of rustworkx’s features. The coupling map is a graph that represents the connectivity of the qubits in a quantum device. First, the coupling map is loaded from IBM’s hardware backend:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">qiskit.providers.fake_provider</span> <span class="kn">import</span> <span class="n">FakeAuckland</span>
<span class="kn">from</span> <span class="n">qiskit.visualization</span> <span class="kn">import</span> <span class="n">plot_gate_map</span><span class="p">,</span> <span class="n">plot_error_map</span>

<span class="n">backend</span> <span class="o">=</span> <span class="nc">FakeAuckland</span><span class="p">()</span>
<span class="n">backend</span><span class="p">.</span><span class="n">coupling_map</span><span class="p">.</span><span class="nf">draw</span><span class="p">()</span>
</code></pre></div></div>
<p><img class="mx-auto d-block mb-2 post-img" src="/assets/img/2023-06-07/auckland-graph.png"><br></p>

<p>The circles in the diagram is a <em>node</em> that represents a physical qubit on the device and the arrows are <em>edges</em> that represent the connectivity between the qubits. Each arrow has a <em>weight</em> that is determined by its corresponding CNOT gate error rate.</p>

<p><img class="mx-auto d-block mb-2 post-img" src="/assets/img/2023-06-07/auckland-error.png"><br></p>

<p>The standard graph algorithms perform summation across the edges of non-negative weights. Thus, the weights, $w$ are defined as the negative log of the CNOT gate success rate:
\(w_{ij}=-\log(1-p_{ij})\)
where $p_{ij}$ is the CNOT gate error rate for the control qubit $i$ and target qubit $j$. Under this convention, smaller weights corresponds to higher success probability. For simplicity, the coupling map will be converted to a undirected graph because of the symmetry of the CNOT gate error rate for <code class="language-plaintext highlighter-rouge">ibm_auckland</code>. Special care taking into consideration of the gate asymmetry is needed for hardware such as the <a href="https://research.ibm.com/blog/eagle-quantum-error-mitigation" rel="external nofollow noopener" target="_blank">Eagle processor</a>, which utilizes uni-directional echoed cross-resonance (ECR) gates.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">import</span> <span class="n">rustworkx</span> <span class="k">as</span> <span class="n">rx</span>

<span class="n">two_q_error_map</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">gate</span><span class="p">,</span> <span class="n">prop_dict</span> <span class="ow">in</span> <span class="n">backend</span><span class="p">.</span><span class="n">target</span><span class="p">.</span><span class="nf">items</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">prop_dict</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="bp">None</span> <span class="ow">in</span> <span class="n">prop_dict</span><span class="p">:</span>
        <span class="k">continue</span>
    <span class="k">for</span> <span class="n">qargs</span><span class="p">,</span> <span class="n">inst_props</span> <span class="ow">in</span> <span class="n">prop_dict</span><span class="p">.</span><span class="nf">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">inst_props</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="nf">len</span><span class="p">(</span><span class="n">qargs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">inst_props</span><span class="p">.</span><span class="n">error</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">two_q_error_map</span><span class="p">[</span><span class="n">qargs</span><span class="p">]</span> <span class="o">=</span> <span class="nf">max</span><span class="p">(</span>
                    <span class="n">two_q_error_map</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="n">qargs</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">inst_props</span><span class="p">.</span><span class="n">error</span>
                <span class="p">)</span>

<span class="c1"># using negative log success probability as weight
# log allows the product of success rate to be treated as simple sum as per the conventional graph treatment
</span><span class="n">two_q_suc</span> <span class="o">=</span> <span class="mi">1</span><span class="o">-</span><span class="n">np</span><span class="p">.</span><span class="nf">array</span><span class="p">(</span><span class="nf">list</span><span class="p">(</span><span class="n">two_q_error_map</span><span class="p">.</span><span class="nf">values</span><span class="p">()))</span>
<span class="n">neg_log_two_q_suc_val</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="n">two_q_suc</span><span class="p">)</span>
<span class="n">neg_log_two_q_suc</span> <span class="o">=</span> <span class="nf">dict</span><span class="p">(</span><span class="nf">zip</span><span class="p">(</span><span class="n">two_q_error_map</span><span class="p">.</span><span class="nf">keys</span><span class="p">(),</span> <span class="n">neg_log_two_q_suc_val</span><span class="p">))</span>

<span class="n">g</span> <span class="o">=</span> <span class="n">rx</span><span class="p">.</span><span class="nc">PyGraph</span><span class="p">()</span>
<span class="n">g</span><span class="p">.</span><span class="nf">extend_from_weighted_edge_list</span><span class="p">([(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="nf">for </span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">neg_log_two_q_suc</span><span class="p">.</span><span class="nf">items</span><span class="p">()])</span>
</code></pre></div></div>

<p>An empty undirected graph <code class="language-plaintext highlighter-rouge">PyGraph</code> object was first created and populated with the weighted edges using <code class="language-plaintext highlighter-rouge">extend_from_weighted_edge_list</code>. This method will create the nodes and edges if they do not exist.</p>

<h3 id="centrality">Centrality</h3>

<h3 id="transversal">Transversal</h3>

<h3 id="mean-spanning-tree">Mean Spanning Tree</h3>

<h2 id="map-coloring-efficient-measurement-and-chemical-structure">Map Coloring, Efficient Measurement and Chemical Structure</h2>

<p><img class="mx-auto d-block mb-2 post-img" src="/assets/img/2023-06-07/apac.png"><br></p>

<h3 id="4-color-theorem">4 Color Theorem</h3>

<h3 id="pauli-grouping">Pauli Grouping</h3>
<p><img class="mx-auto d-block mb-2 post-img" src="/assets/img/2023-06-07/apac.png"><br></p>

<h3 id="variational-quantum-eigensolver">Variational Quantum Eigensolver</h3>

<h2 id="final-remarks">Final Remarks</h2>

      </d-article>

      <d-appendix>
        <d-footnote-list></d-footnote-list>
        <d-citation-list></d-citation-list>
      </d-appendix>

      <d-bibliography src="/assets/bibliography/2023-06-07.bib"></d-bibliography>
</div>

    <!-- Footer -->    
    <footer class="fixed-bottom">
      <div class="container mt-0">
        © Copyright 2023 Soon  Teh. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>.

      </div>
    </footer>

    <!-- Bootsrap & MDB scripts -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js" integrity="sha256-fgLAgv7fyCGopR/gBNq2iW3ZKIdqIcyshnUULC4vex8=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script>

    <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-GF8TKGK3W4"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){ window.dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'G-GF8TKGK3W4');
  </script>
    

<!-- Scrolling Progress Bar -->
<script type="text/javascript">
  /*
   * This JavaScript code has been adapted from the article 
   * https://css-tricks.com/reading-position-indicator/ authored by Pankaj Parashar, 
   * published on the website https://css-tricks.com on the 7th of May, 2014.
   * Couple of changes were made to the original code to make it compatible 
   * with the `al-foio` theme.
   */
  const progressBar = $("#progress");
  /*
   * We set up the bar after all elements are done loading.
   * In some cases, if the images in the page are larger than the intended
   * size they'll have on the page, they'll be resized via CSS to accomodate
   * the desired size. This mistake, however, breaks the computations as the
   * scroll size is computed as soon as the elements finish loading.
   * To account for this, a minimal delay was introduced before computing the
   * values.
   */
  window.onload = function () {
    setTimeout(progressBarSetup, 50);
  };
  /*
   * We set up the bar according to the browser.
   * If the browser supports the progress element we use that.
   * Otherwise, we resize the bar thru CSS styling
   */
  function progressBarSetup() {
    if ("max" in document.createElement("progress")) {
      initializeProgressElement();
      $(document).on("scroll", function() {
        progressBar.attr({ value: getCurrentScrollPosition() });
      });
      $(window).on("resize", initializeProgressElement);
    } else {
      resizeProgressBar();
      $(document).on("scroll", resizeProgressBar);
      $(window).on("resize", resizeProgressBar);
    }
  }
  /*
   * The vertical scroll position is the same as the number of pixels that
   * are hidden from view above the scrollable area. Thus, a value > 0 is
   * how much the user has scrolled from the top
   */
  function getCurrentScrollPosition() {
    return $(window).scrollTop();
  }

  function initializeProgressElement() {
    let navbarHeight = $("#navbar").outerHeight(true);
    $("body").css({ "padding-top": navbarHeight });
    $("progress-container").css({ "padding-top": navbarHeight });
    progressBar.css({ top: navbarHeight });
    progressBar.attr({
      max: getDistanceToScroll(),
      value: getCurrentScrollPosition(),
    });
  }
  /*
   * The offset between the html document height and the browser viewport
   * height will be greater than zero if vertical scroll is possible.
   * This is the distance the user can scroll
   */
  function getDistanceToScroll() {
    return $(document).height() - $(window).height();
  }

  function resizeProgressBar() {
    progressBar.css({ width: getWidthPercentage() + "%" });
  }
  // The scroll ratio equals the percentage to resize the bar
  function getWidthPercentage() {
    return (getCurrentScrollPosition() / getDistanceToScroll()) * 100;
  }
</script>

  
</body>
</html>
